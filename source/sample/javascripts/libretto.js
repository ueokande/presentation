(function(){window.Libretto={}}).call(this),function(){window.Libretto.Animation=function(){function t(t){var e,n,i,r,o,s,a,u;for(this.page=t,this.keyframes=[],this.index=0,e=this.page.element.getElementsByTagName("animation"),o=0,a=e.length;a>o;o++)for(r=e[o],i=r.getElementsByTagName("keyframe"),s=0,u=i.length;u>s;s++)n=i[s],this.keyframes.push(new Libretto.Keyframe(n));this.css=Libretto.Css.findOrCreate("animation-"+this.page.indexOf())}return t.prototype.reset=function(){return this.css.clearRules(),this.index=0},t.prototype.hasNextKeyframe=function(){return this.index<this.keyframes.length},t.prototype.nextKeyframe=function(){return this.hasNextKeyframe()?this.execKeyframe(0):null},t.prototype.execKeyframe=function(e){var n,i,r,o,s,a,u;return r=this.keyframes[this.index],++this.index,a=r.target(),null===a?(console.warn("The animation target is not specified."),null):(s=r.properties(),i=r.duration(),n=null===r.delay()?e+"ms":t.timeToMillisecond(r.delay())+e+"ms",s["transition-duration"]=i,s["transition-delay"]=n,u="section:nth-of-type("+(this.page.indexOf()+1)+") "+a,this.css.addRule(u,s),this.hasNextKeyframe()?(o=this.keyframes[this.index],"with"===o.timing()?this.execKeyframe(e):"after"===o.timing()&&(null!==i&&(e+=t.timeToMillisecond(i)),this.execKeyframe(e)),0):void 0)},t.timeToMillisecond=function(t){var e,n,i;return 0===t.length?null:(e=+t.split("ms")[0],n=1e3*t.split("s")[0],i=e||n,isNaN(i)?null:i)},t}()}.call(this),function(){window.Libretto.Css=function(){function t(){}return t.create=function(t){var e,n;return e=new Libretto.Css,n=document.createElement("style"),n.appendChild(document.createTextNode("")),void 0!==t&&(n.id=t),window.document.head.appendChild(n),e.style=n,e},t.findById=function(t){var e,n;return n=document.getElementById(t),null===n?null:/style/i.test(n.tagName)?(e=new Libretto.Css,e.style=n,e):(console.error("The element '#"+t+"' is existing.  The id was conflicted."),null)},t.findOrCreate=function(t){var e,n;return n=document.getElementById(t),null===n?Libretto.Css.create(t):/style/i.test(n.tagName)?(e=new Libretto.Css,e.style=n,e):(console.error("The element '#"+t+"' is existing.  The id was conflicted."),null)},t.prototype.rules=function(){return null===this.style?null:void 0!==this.style.sheet.cssRules?this.style.sheet.cssRules:this.style.sheet.rules},t.prototype.removeRule=function(){return void 0!==this.style.sheet.deleteRule?this.style.sheet.deleteRule(0):this.style.sheet.removeRule(0)},t.prototype.addRule=function(t,e){var n,i,r,o;if(null!==this.style){if(r=this.rules().length,void 0===e)return n=""+t+" {}",this.style.sheet.insertRule(n,r),this.rules()[r].style;n=""+t+" {";for(i in e)o=e[i],n+=""+i+": "+o+" !important;";return n+="}",this.style.sheet.insertRule(n,r)}},t.prototype.clearRules=function(){var t;if(null!==this.style){for(t=[];0!==this.rules().length;)t.push(this.removeRule(0));return t}},t.prototype.finalize=function(){return null!==this.style?(window.document.head.removeChild(this.style),this.style=null):void 0},t}()}.call(this),function(){window.Libretto.EventListener=function(){function t(){}return t.prototype.addEventListener=function(t,e){return void 0===this.listeners&&(this.listeners={}),this.listeners.hasOwnProperty(t)?this.listeners[t].push(e):this.listeners[t]=[e]},t.prototype.invokeEventListeners=function(t){var e,n,i,r,o;if(void 0!==this.listeners&&this.listeners.hasOwnProperty(t)){for(r=this.listeners[t],o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(e());return o}},t}()}.call(this),function(){window.Libretto.Keyframe=function(){function t(t){this.element=t,void 0===this.element&&(this.element=null)}return t.prototype.target=function(){return null===this.element?null:this.element.getAttribute("target")},t.prototype.duration=function(){return null===this.element?null:this.element.getAttribute("duration")},t.prototype.properties=function(){var t,e,n,i,r,o;if(null===this.element)return null;for(n={},e=this.element.attributes,o=this.element.attributes,i=0,r=o.length;r>i;i++)t=o[i],"target"!==t.nodeName&&"duration"!==t.nodeName&&(n[t.nodeName]=t.value);return n},t.prototype.delay=function(){return null===this.element?null:this.element.getAttribute("delay")},t.prototype.timing=function(){return null===this.element?null:this.element.getAttribute("timing")},t}()}.call(this),function(){window.Libretto.Page=function(){function t(){}return t.count=function(){return this.sectionNodes().length},t.pageAt=function(t){var e,n;return e=this.sectionNodes()[t],void 0===e?null:(n=new Libretto.Page,n.element=e,n)},t.sectionNodes=function(){var t,e,n,i,r;for(t=document.body.children,n=[],i=0,r=t.length;r>i;i++)e=t[i],e.tagName.match(/section/i)&&n.push(e);return n},t.prototype.animationEffect=function(){return null===this.element?null:this.element.getAttribute("effect")},t.prototype.animationDuration=function(){return null===this.element?null:this.element.getAttribute("duration")},t.prototype.animationOptions=function(){var t,e,n,i,r;if(null===this.element)return null;for(e={},r=this.element.attributes,n=0,i=r.length;i>n;n++)t=r[n],"style"!==t.nodeName&&"effect"!==t.nodeName&&"duration"!==t.nodeName&&(e[t.nodeName]=t.value);return e},t.prototype.indexOf=function(){var t;return t=Libretto.Page.sectionNodes(),t.indexOf(this.element)},t.prototype.animation=function(){return null===this.element?null:new Libretto.Animation(this)},t}()}.call(this),function(){window.Libretto.pageEffects={},window.Libretto.registerPageEffect=function(t,e){return Libretto.pageEffects[t.toLowerCase()]=e},window.Libretto.loadPageEffect=function(t){return t=t.toLowerCase(),Libretto.pageEffects.hasOwnProperty(t)?Libretto.pageEffects[t]:null}}.call(this),function(){window.Libretto.PageTransition=function(){function t(t,e,n,i){var r;this.prevIndex=t,this.nextIndex=e,this.nextPage=n,void 0===r&&(r="PageTransition"),this.pageAnimeCss=Libretto.Css.findOrCreate(i)}var e,n,i;return t.prototype.finalize=function(){return this.pageAnimeCss.finalize()},t.prototype.switchPage=function(t){return t?e.call(this):i.call(this)},i=function(){return n.call(this)},e=function(){var t,e,i,r;return i=this.nextPage.animationEffect(),t=this.nextPage.animationDuration(),r=this.nextPage.animationOptions(),e=null===i?null:Libretto.loadPageEffect(i),null===e&&console.warn("No such page effect : "+i),null===e?n.call(this):n.call(this,e(),t,r)},n=function(t,e,n){var i,r;return this.pageAnimeCss.clearRules(),null!==this.prevIndex&&(r=this.pageAnimeCss.addRule("section:nth-of-type("+(this.prevIndex+1)+")"),r.visibility="visible",r.zIndex=0),i=this.pageAnimeCss.addRule("section:nth-of-type("+(this.nextIndex+1)+")"),i.visibility="visible",i.zIndex=1,void 0!==t?(t.hasOwnProperty("before")&&t.before(r,i,e,n),setTimeout(function(){return t.exec(r,i,e,n)},50)):void 0},t}()}.call(this),function(){window.Libretto.Viewer=function(){function t(){this.currentAnimation=null,this.currentIndex=null,this.pageTransition=null,this.currentPageChangedListeners=[],window.Libretto.viewer=this}var e;return t.viewer=function(){return window.Libretto.viewer},t.prototype.getCurrentIndex=function(){return this.currentIndex},t.prototype.skipToPage=function(t){return 0!==Libretto.Page.count()?e.call(this,t,!1):void 0},t.prototype.animateToPage=function(t){return 0!==Libretto.Page.count()?e.call(this,t,!0):void 0},e=function(t,e){var n,i,r,o,s,a,u,l;if(t=Math.max(0,t),t=Math.min(Libretto.Page.count()-1,t),t!==this.currentIndex){for(o=this.currentIndex,r=t,n=Libretto.Page.pageAt(t),this.currentIndex=t,this.currentAnimation=n.animation(),this.currentAnimation.reset(),null!==this.pageTransition&&this.pageTransition.finalize(),this.pageTransition=new Libretto.PageTransition(o,r,n),this.pageTransition.switchPage(e),u=this.currentPageChangedListeners,l=[],s=0,a=u.length;a>s;s++)i=u[s],l.push(i());return l}},t.prototype.nextStep=function(){return this.currentAnimation.hasNextKeyframe()?this.currentAnimation.nextKeyframe():this.animateToPage(this.currentIndex+1)},t.prototype.prevStep=function(){return this.skipToPrevPage()},t.prototype.skipToNextPage=function(){return this.skipToPage(this.currentIndex+1)},t.prototype.skipToPrevPage=function(){return this.skipToPage(this.currentIndex-1)},t.prototype.skipToFirstPage=function(){return this.skipToPage(0)},t.prototype.skipToLastPage=function(){return this.skipToPage(Libretto.Page.count()-1)},t.prototype.addCurrentPageChangedListener=function(t){return this.currentPageChangedListeners.push(t)},t}(),new window.Libretto.Viewer}.call(this),function(){window.Libretto.Plugin=function(){function t(){window.addEventListener("load",this.initialize)}return t.prototype.initialize=function(){},t}()}.call(this),function(){Libretto.registerPageEffect("dissolve",function(){return{before:function(t,e){return e.opacity="0"},exec:function(t,e,n){return e.transitionDuration=n,e.opacity="1"}}}),Libretto.registerPageEffect("move-in",function(){return{before:function(t,e,n,i){var r;return r={left:["100%","0%"],right:["-100%","0%"],up:["0%","100%"],down:["0%","-100%"]}[i.direction],null===r&&(null!==i.direction&&console.warn("Invalid value of direction: "+i.direction),r=["100%","0%"]),e.left=r[0],e.top=r[1]},exec:function(t,e,n){return null===n&&(n="1s"),e.transitionDuration=n,e.left="0%",e.top="0%"}}}),Libretto.registerPageEffect("push",function(){return{before:function(t,e,n,i){var r;return r={left:["0%","0%","100%","0%","-100%","0%","0%","0%"],right:["0%","0%","-100%","0%","100%","0%","0%","0%"],up:["0%","0%","0%","100%","0%","-100%","0%","0%"],down:["0%","0%","0%","-100%","0%","100%","0%","0%"]},this.pos=r[i.direction],void 0===this.pos&&(void 0!==i.direction&&console.warn("Invalid value of direction: "+i.direction),this.pos=r.left),t.left=this.pos[0],t.top=this.pos[1],e.left=this.pos[2],e.top=this.pos[3]},exec:function(t,e,n){return null===n&&(n="1s"),t.transitionDuration=n,t.left=this.pos[4],t.top=this.pos[5],e.transitionDuration=n,e.left=this.pos[6],e.top=this.pos[7]}}}),Libretto.registerPageEffect("scale",function(){return{before:function(t,e,n,i){var r;switch(r=i.direction,this.targetNext=!0,this.zoomin=!0,r){case"up":this.targetNext=!0,this.zoomin=!0;break;case"in":this.targetNext=!0,this.zoomin=!1;break;case"out":this.targetNext=!1,this.zoomin=!0;break;case"down":this.targetNext=!1,this.zoomin=!1;break;default:null!==r&&console.warn("Invalid value of direction: "+r)}return this.targetNext?(t.zIndex="0",e.zIndex="1",e.opacity="0",this.zoomin?(e.transform="scale(0.2,0.2)",e.mozTransform="scale(0.2,0.2)",e.webkitTransform="scale(0.2,0.2)"):(e.transform="scale(3.0,3.0)",e.mozTransform="scale(3.0,3.0)",e.webkitTransform="scale(3.0,3.0)")):(t.zIndex="1",e.zIndex="0",t.opacity="1",e.transform="scale(1,1)",e.mozTransform="scale(1,1)",e.webkitTransform="scale(1,1)")},exec:function(t,e,n){return null===n&&(n="1s"),this.targetNext?(e.transitionDuration=n,e.opacity="1",e.transform="scale(1.0,1.0)",e.mozTransform="scale(1.0,1.0)",e.webkitTransform="scale(1.0,1.0)"):(t.transitionDuration=n,t.opacity="0",this.zoomin?(t.transform="scale(3,3)",t.mozTransform="scale(3,3)",t.webkitTransform="scale(3,3)"):(t.transform="scale(0.2,0.2)",t.mozTransform="scale(0.2,0.2)",t.webkitTransform="scale(0.2,0.2)"))}}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Libretto.AutoZoom=function(e){function i(){return this.fitToWindow=t(this.fitToWindow,this),this.initialize=t(this.initialize,this),i.__super__.constructor.apply(this,arguments)}var r,o;return n(i,e),i.prototype.initialize=function(){return this.initialBodyWidth=o.call(this),this.initialBodyHeight=r.call(this),window.addEventListener("resize",this.fitToWindow),this.fitToWindow()},i.prototype.fitToWindow=function(){var t,e,n;return e=window.innerWidth,t=window.innerHeight,n=Math.min(e/this.initialBodyWidth,t/this.initialBodyHeight),window.document.body.style.transform="scale("+n+")",window.document.body.style.transformOrigin="0 0"},o=function(){return window.getComputedStyle(window.document.body).width.split("px")[0]},r=function(){return window.getComputedStyle(window.document.body).height.split("px")[0]},i}(window.Libretto.Plugin),new window.Libretto.AutoZoom}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Libretto.ElementCarry=function(e){function i(){return this.mouseMove=t(this.mouseMove,this),this.mouseUp=t(this.mouseUp,this),this.mouseDown=t(this.mouseDown,this),this.initialize=t(this.initialize,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(){return this.css=new Libretto.Css("element-carry"),this.css.addRule(".element-carry-highlight",{"box-shadow":"0 0 8px #44f"}),this.targetObject=null,this.prevHovered=null,window.addEventListener("mousedown",function(t){return function(e){return t.mouseDown(e.button,e.clientX,e.clientY)}}(this)),window.addEventListener("mouseup",function(t){return function(e){return t.mouseUp(e.button,e.clientX,e.clientY)}}(this)),window.addEventListener("mousemove",function(t){return function(e){return t.mouseMove(e.button,e.clientX,e.clientY)}}(this))},i.prototype.stringPxToInt=function(t){return 0===t.length?0:+t.split("px")[0]},i.prototype.highlightElement=function(t){var e;return e=t.getBoundingClientRect(),this.highlight.style.left=e.left,this.highlight.style.top=e.top,this.highlight.style.width=e.width,this.highlight.style.height=e.height},i.prototype.underElement=function(t,e){var n;return n=window.document.elementFromPoint(t,e),n.tagName.match(/thead|tbody|tr|td|th/i)&&(n=function(t,e){var n;return n=t.parentElement,null===n?null:n.tagName.match(new RegExp(e,"i"))?n:arguments.callee(n,e)}(n,"table")),n},i.prototype.mouseDown=function(t,e,n){var i;if(1===t&&(i=this.underElement(e,n),!i.tagName.match(/section/i)))return this.targetObject=i,this.zoom=+getComputedStyle(document.body).zoom,this.mouseOriginX=e,this.mouseOriginY=n,this.initialX=+window.getComputedStyle(this.targetObject).marginLeft.split("px")[0],this.initialY=+window.getComputedStyle(this.targetObject).marginTop.split("px")[0]},i.prototype.mouseUp=function(t){return 1===t?this.targetObject=null:void 0},i.prototype.mouseMove=function(t,e,n){var i,r,o;return null!==this.targetObject?(i=(e-this.mouseOriginX)/this.zoom,r=(n-this.mouseOriginY)/this.zoom,Math.abs(i)<8?this.targetObject.style.removeProperty("margin-left"):this.targetObject.style.marginLeft=this.initialX+i,Math.abs(r)<8?this.targetObject.style.removeProperty("margin-top"):this.targetObject.style.marginTop=r,o=this.targetObject):o=this.underElement(e,n),this.prevHovered!==o?(null!==this.prevHovered&&this.prevHovered.classList.remove("element-carry-highlight"),o.classList.add("element-carry-highlight"),this.prevHovered=o):void 0},i}(window.Libretto.Plugin)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Libretto.IO=function(e){function i(){return this.initialize=t(this.initialize,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(){return window.addEventListener("keypress",function(){return function(t){var e;return e=window.Libretto.Viewer.viewer(),t.charCode==="[".charCodeAt(0)?e.skipToPrevPage():t.charCode==="]".charCodeAt(0)?e.skipToNextPage():void 0}}(this)),window.addEventListener("keydown",function(){return function(t){var e;switch(e=window.Libretto.Viewer.viewer(),t.keyCode){case 32:case 40:case 34:return e.nextStep();case 38:case 33:return e.prevStep();case 36:return e.skipToFirstPage();case 35:return e.skipToLastPage()}}}(this)),window.addEventListener("click",function(){return function(t){var e;if(0===t.button)return e=window.Libretto.Viewer.viewer(),e.nextStep()}}(this))},i}(window.Libretto.Plugin),new window.Libretto.IO}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};window.Libretto.Location=function(e){function i(){return this.setHash=t(this.setHash,this),this.initialize=t(this.initialize,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(){var t;return window.addEventListener("hashchange",function(t){return function(){return t.applyPage()}}(this)),t=window.Libretto.Viewer.viewer(),t.addCurrentPageChangedListener(function(e){return function(){var n;return n=t.getCurrentIndex(),e.setHash(n)}}(this)),this.applyPage()},i.prototype.setHash=function(t){return window.location.hash=t+1},i.prototype.applyPage=function(){var t,e;return t=+window.location.hash.split("#")[1],isNaN(t)&&(t=1),e=window.Libretto.Viewer.viewer(),e.skipToPage(t-1)},i}(window.Libretto.Plugin),new window.Libretto.Location}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};window.Libretto.Pager=function(t){function n(){this.inputBox=null,this.show-!1,window.addEventListener("keypress",function(t){var e;if(!this.shown)return"0".charCodeAt(0)<=t.charCode&&t.charCode<="9".charCodeAt(0)?(e=String.fromCharCode(t.charCode),this.inputBox.focus(),this.showPager()):void 0})}return e(n,t),n.prototype.initialize=function(){var t,e;return e=document.createElement("input"),e.type="text",e.style.cssText="font-size        : 16px;\ntext-align       : center;\nwidth            : 48px;\nheight           : 24px;\nbackground-color : #000;\ncolor            : #fff;",e.onkeydown=this.inputKeyEvent,t=document.createElement("div"),t.style.cssText="position            : absolute;\nbackground-color    : #222;\nbox-shadow          : 0px 0px 12px #333;\npadding             : 16px;\npaddingTop          : 28px;\nleft                : 50%;\nborder-radius       : 12px;\nmargin-left         : -40px;\ntransition-target   : top;\ntransition-duration : 300ms;",t.insertBefore(e,null),this.inputBox=e,document.body.insertBefore(t),this.hidePager()},n.prototype.showPager=function(){return this.inputBox.value="",elem.style.top="-12px",this.shown=!0},n.prototype.hidePager=function(){return elem.style.top="-84px",this.shown=!1},n.prototype.inputKeyEvent=function(t){var e,n;if(13===t.keyCode)return e=~~this.inputBox.value,n=window.Libretto.Viewer.viewer(),n.skipToPage(e-1),this.hidePager()},n}(window.Libretto.Plugin)}.call(this),function(){}.call(this);